(rule
  (target bundler.ml)
  (deps main.ml)
  (action
    (with-stdout-to %{target}
    (progn
      (echo "let bundled_code = {source_code|")
      (cat main.ml)
      (echo "|source_code} let is_bundled = false")))))

(executable
 (public_name soluna)
 (name main)
 (libraries soluna)
 (modules main bundler))
